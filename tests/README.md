# ChronoClip 設定システム テストページ

このディレクトリには、ChronoClip の設定システムを統合的にテストするためのページが含まれています。

## ファイル構成

- `settings-integration-test.html` - 設定システムの統合テストページ
- `date-detection.test.js` - 日付検出のロジックテスト
- `test.html` - 日付検出テスト用の HTML ページ

## 設定システム統合テスト (`settings-integration-test.html`)

このテストページは、ChronoClip の設定管理システムの以下の機能をテストします：

### テスト項目

1. **基本機能テスト**

   - 設定の読み込み
   - 設定の保存
   - デフォルト値の確認

2. **バリデーションテスト**

   - 正常な設定値の検証
   - 異常な設定値の拒否
   - 型チェック

3. **マイグレーションテスト**

   - 古いバージョンの設定を新しい形式に移行
   - バージョン管理の確認

4. **ブロードキャストテスト**
   - 設定変更の他のタブへの通知
   - イベントリスナーの動作確認

### 使用方法

#### ⚠️ 重要：拡張機能コンテキストでの実行が必要

このテストページは**Chrome 拡張機能のコンテキストで実行する必要があります**。通常の Web ページとして開いても、Chrome Storage API が利用できないため、すべてのテストがスキップされます。

#### 方法 1: オプションページから開く（推奨）

1. Chrome 拡張機能を読み込む
2. 拡張機能の「オプション」を開く
3. ページ下部の「📊 設定システムのテストページを開く」ボタンをクリック

#### 方法 2: 直接 URL アクセス

1. Chrome 拡張機能を読み込む
2. ブラウザのアドレスバーに以下を入力：

   ```text
   chrome-extension://<extension-id>/tests/settings-integration-test.html
   ```

   （`<extension-id>`は拡張機能の実際の ID に置き換え）

#### 方法 3: 開発者モード

1. `chrome://extensions/` を開く
2. 「開発者モード」を有効にする
3. 「パッケージ化されていない拡張機能を読み込む」でプロジェクトフォルダを選択
4. 拡張機能が読み込まれたら、方法 1 または方法 2 を使用

### テスト実行

1. ページが読み込まれると、自動的に Chrome API 利用可能性がチェックされます
2. 利用可能な場合：現在の設定が表示されます
3. 利用できない場合：警告メッセージが表示されます

#### 個別テスト実行

各テストは個別に実行できます：

- 「1. 基本機能テスト」→「実行」ボタン
- 「2. バリデーションテスト」→「実行」ボタン
- 「3. マイグレーションテスト」→「実行」ボタン
- 「4. ブロードキャストテスト」→「実行」ボタン

#### 全テスト実行

「全テスト実行」ボタンをクリックすると、すべてのテストが順次実行されます。

### テスト結果の見方

- ✅ **緑色**: テスト成功
- ❌ **赤色**: テスト失敗
- ⚠️ **黄色**: Chrome API が利用できないためスキップ

### トラブルシューティング

#### 「Chrome API が利用できません」と表示される場合

1. 拡張機能が正しく読み込まれているか確認
2. `chrome-extension://` URL から開いているか確認
3. manifest.json の`web_accessible_resources`に`tests/settings-integration-test.html`が含まれているか確認

#### テストが失敗する場合

1. ブラウザの DevTools の Console タブでエラーメッセージを確認
2. Chrome Storage API の権限が正しく設定されているか確認
3. lib/settings.js が正しく読み込まれているか確認

### 注意事項

- テスト実行中は実際の設定が変更される場合があります
- テスト完了後、必要に応じて設定をリセットしてください（「デフォルトに戻す」ボタン）
- マイグレーションテストは実際のストレージに古い設定を保存してからテストします

## その他のテスト

### 日付検出テスト (`test.html`, `date-detection.test.js`)

日付検出ロジックの単体テストです。これらは通常の Web ページとして実行できます。

```bash
# ブラウザで直接開く
open tests/test.html
```
