<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChronoClip ã‚¤ãƒ™ãƒ³ãƒˆæŠ½å‡ºãƒ†ã‚¹ãƒˆ</title>
    <style>
      body {
        font-family: "Helvetica Neue", Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .test-header {
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }
      .test-case {
        background: #f8f9fa;
        padding: 15px;
        border-left: 4px solid #28a745;
        margin: 10px 0;
      }
      .test-case.error {
        border-left-color: #dc3545;
        background: #f8d7da;
      }
      .result {
        background: #e9ecef;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      #output {
        font-family: monospace;
        background: #2c3e50;
        color: #ecf0f1;
        padding: 15px;
        border-radius: 4px;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
      }
      .chronoclip-date {
        background: #ffd700;
        padding: 2px 4px;
        border-radius: 3px;
        font-weight: bold;
        cursor: pointer;
      }
      .notice {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1 class="test-header">ChronoClip ã‚¤ãƒ™ãƒ³ãƒˆæŠ½å‡ºæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>

      <div class="notice">
        <strong>ğŸ“ ãƒ†ã‚¹ãƒˆæ–¹æ³•:</strong>
        <ol>
          <li>å„ã‚µãƒ³ãƒ—ãƒ«ã®é»„è‰²ã„æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</li>
          <li>
            Chromeæ‹¡å¼µæ©Ÿèƒ½ãŒæœ‰åŠ¹ãªå ´åˆã€è‡ªå‹•çš„ã«æŠ½å‡ºçµæœãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã¾ã™
          </li>
          <li>ã€Œã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã§ç‹¬ç«‹ã—ãŸãƒ†ã‚¹ãƒˆã‚‚å¯èƒ½ã§ã™</li>
        </ol>
      </div>

      <div style="margin-bottom: 20px">
        <button onclick="window.testController.runAllTests()">
          ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        </button>
        <button onclick="window.testController.clearOutput()">
          å‡ºåŠ›ã‚¯ãƒªã‚¢
        </button>
        <button onclick="window.testController.showConsoleInstructions()">
          ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç¢ºèªæ–¹æ³•
        </button>
      </div>

      <pre id="output"></pre>
    </div>

    <!-- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”¨ã®ã‚µãƒ³ãƒ—ãƒ«HTML -->
    <div class="test-container">
      <h2>ã‚µãƒ³ãƒ—ãƒ«1: è¦‹å‡ºã—ç›´ä¸‹ã®æ—¥ä»˜</h2>
      <div class="test-case" id="sample1">
        <h3>å¤ã®å¤§ä¼š 2025</h3>
        <p>
          é–‹å‚¬æ—¥:
          <span class="chronoclip-date" data-normalized-date="2025-08-27"
            >8æœˆ27æ—¥(æ°´)</span
          >
        </p>
        <p>ä¼šå ´: æ±äº¬ãƒ‰ãƒ¼ãƒ  é–‹å ´17:00 é–‹æ¼”18:00</p>
        <div class="result" id="result1">
          <em
            >ä¸Šã®æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã€‚çµæœã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ç¢ºèªã§ãã¾ã™ã€‚</em
          >
        </div>
      </div>
    </div>

    <div class="test-container">
      <h2>ã‚µãƒ³ãƒ—ãƒ«2: ç®‡æ¡æ›¸ãã‚¤ãƒ™ãƒ³ãƒˆ</h2>
      <div class="test-case" id="sample2">
        <h3>ä»Šæœˆã®ã‚¤ãƒ™ãƒ³ãƒˆ</h3>
        <ul>
          <li>
            <strong>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç™ºè¡¨ä¼š</strong>
            <span class="chronoclip-date" data-normalized-date="2025-08-28"
              >8æœˆ28æ—¥</span
            >
            <p>å„ãƒãƒ¼ãƒ ã®æˆæœç™ºè¡¨ã¨è³ªç–‘å¿œç­”ã‚’è¡Œã„ã¾ã™ã€‚</p>
          </li>
        </ul>
        <div class="result" id="result2">
          <em
            >ä¸Šã®æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã€‚çµæœã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ç¢ºèªã§ãã¾ã™ã€‚</em
          >
        </div>
      </div>
    </div>

    <div class="test-container">
      <h2>ã‚µãƒ³ãƒ—ãƒ«3: é›¢ã‚ŒãŸè¦ç´ </h2>
      <div class="test-case" id="sample3">
        <header>
          <h1>é‡è¦ãªãŠçŸ¥ã‚‰ã›</h1>
          <div class="meta">
            æŠ•ç¨¿æ—¥:
            <span class="chronoclip-date" data-normalized-date="2025-08-27"
              >2025å¹´8æœˆ27æ—¥</span
            >
          </div>
        </header>
        <div class="content">
          <p>ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŸã‚ã€ä¸€æ™‚çš„ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ã„ãŸã—ã¾ã™ã€‚</p>
        </div>
        <div class="result" id="result3">
          <em
            >ä¸Šã®æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã€‚çµæœã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ç¢ºèªã§ãã¾ã™ã€‚</em
          >
        </div>
      </div>
    </div>

    <div class="test-container">
      <h2>ã‚µãƒ³ãƒ—ãƒ«4: è‹±èªãƒšãƒ¼ã‚¸</h2>
      <div class="test-case" id="sample4">
        <h2>Annual Conference 2025</h2>
        <p>
          Date:
          <span class="chronoclip-date" data-normalized-date="2025-08-28"
            >Aug 28, 2025</span
          >
        </p>
        <p>Location: Tokyo International Forum</p>
        <div class="result" id="result4">
          <em
            >ä¸Šã®æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã€‚çµæœã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ç¢ºèªã§ãã¾ã™ã€‚</em
          >
        </div>
      </div>
    </div>

    <!-- ãƒ†ã‚¹ãƒˆç”¨ã®éè¡¨ç¤ºã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="test-container" style="display: none"></div>

    <!-- ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆç”¨ã®extractor.jsèª­ã¿è¾¼ã¿ -->
    <script>
      // Chromeæ‹¡å¼µæ©Ÿèƒ½ç’°å¢ƒã§ã¯ãªã„å ´åˆã®ã¿extractor.jsã‚’èª­ã¿è¾¼ã¿
      if (!window.chrome || !window.chrome.runtime) {
        const script = document.createElement("script");
        script.src = "../content/extractor.js";
        document.head.appendChild(script);
      }
    </script>

    <script>
      // ãƒ†ã‚¹ãƒˆåˆ¶å¾¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
      window.testController = {
        output: null,

        init() {
          this.output = document.getElementById("output");
          this.log("ChronoClip ã‚¤ãƒ™ãƒ³ãƒˆæŠ½å‡ºãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚");

          // Chromeæ‹¡å¼µæ©Ÿèƒ½ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯
          if (window.chrome && window.chrome.runtime) {
            this.log("âœ“ Chromeæ‹¡å¼µæ©Ÿèƒ½ç’°å¢ƒã§å‹•ä½œä¸­");
            this.log(
              "  æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«æŠ½å‡ºå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚"
            );
            this.log("  çµæœã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12 â†’ Consoleï¼‰ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
          } else {
            this.log("âš  ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ç’°å¢ƒã§å‹•ä½œä¸­");
            this.log("  ã€Œã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã§ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚");
          }
        },

        log(message) {
          if (this.output) {
            this.output.textContent +=
              new Date().toLocaleTimeString() + " - " + message + "\n";
            this.output.scrollTop = this.output.scrollHeight;
          }
          console.log("ChronoClip Test:", message);
        },

        clearOutput() {
          if (this.output) {
            this.output.textContent = "";
          }
        },

        showConsoleInstructions() {
          this.log("=== ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç¢ºèªæ–¹æ³• ===");
          this.log("1. F12ã‚­ãƒ¼ã‚’æŠ¼ã™ï¼ˆã¾ãŸã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼‰");
          this.log('2. "Console"ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯');
          this.log("3. æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æŠ½å‡ºçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™");
          this.log(
            '4. "ChronoClip: Extracted event context:"ã§å§‹ã¾ã‚‹ãƒ­ã‚°ã‚’ç¢ºèª'
          );
        },

        async runAllTests() {
          this.log("=== ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆé–‹å§‹ ===");

          // extractor.jsãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
          let attempts = 0;
          while (!window.ChronoClipExtractor && attempts < 10) {
            await new Promise((resolve) => setTimeout(resolve, 100));
            attempts++;
          }

          if (!window.ChronoClipExtractor) {
            this.log("âœ— extractor.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“");
            this.log(
              "  Chromeæ‹¡å¼µæ©Ÿèƒ½ç’°å¢ƒã§ã¯ã€ç›´æ¥æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚"
            );
            return;
          }

          const { extractEventContext, normalizeText } =
            window.ChronoClipExtractor;

          try {
            // ãƒ†ã‚¹ãƒˆ1: åŸºæœ¬çš„ãªæŠ½å‡º
            this.log("--- ãƒ†ã‚¹ãƒˆ1: è¦‹å‡ºã—ç›´ä¸‹ã®æ—¥ä»˜ ---");
            const html1 = `
                        <article>
                            <h2>å¤ã®å¤§ä¼š 2025</h2>
                            <p>é–‹å‚¬æ—¥: <span class="test-date">8æœˆ27æ—¥(æ°´)</span></p>
                            <p>ä¼šå ´: æ±äº¬ãƒ‰ãƒ¼ãƒ  é–‹å ´17:00 é–‹æ¼”18:00</p>
                        </article>
                    `;
            const result1 = this.runSingleTest(html1, extractEventContext);
            this.log(`âœ“ ã‚¿ã‚¤ãƒˆãƒ«: "${result1.title}"`);
            this.log(`âœ“ ä¿¡é ¼åº¦: ${result1.confidence.toFixed(3)}`);

            // ãƒ†ã‚¹ãƒˆ2: ãƒªã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ
            this.log("--- ãƒ†ã‚¹ãƒˆ2: ç®‡æ¡æ›¸ãã‚¤ãƒ™ãƒ³ãƒˆ ---");
            const html2 = `
                        <div>
                            <h3>ä»Šæœˆã®ã‚¤ãƒ™ãƒ³ãƒˆ</h3>
                            <ul>
                                <li>
                                    <strong>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç™ºè¡¨ä¼š</strong>
                                    <span class="test-date">8æœˆ28æ—¥</span>
                                    <p>å„ãƒãƒ¼ãƒ ã®æˆæœç™ºè¡¨ã¨è³ªç–‘å¿œç­”ã‚’è¡Œã„ã¾ã™ã€‚</p>
                                </li>
                            </ul>
                        </div>
                    `;
            const result2 = this.runSingleTest(html2, extractEventContext);
            this.log(`âœ“ ã‚¿ã‚¤ãƒˆãƒ«: "${result2.title}"`);
            this.log(`âœ“ ä¿¡é ¼åº¦: ${result2.confidence.toFixed(3)}`);

            // ãƒ†ã‚¹ãƒˆ3: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
            this.log("--- ãƒ†ã‚¹ãƒˆ3: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ---");
            const normalized = normalizeText("  test\n\ntext  \t  ");
            if (normalized === "test text") {
              this.log("âœ“ normalizeText æˆåŠŸ");
            } else {
              this.log(`âœ— normalizeText å¤±æ•—: "${normalized}"`);
            }

            this.log("=== ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ†ã‚¹ãƒˆå®Œäº† ===");
          } catch (error) {
            this.log(`âœ— ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
          }
        },

        runSingleTest(html, extractFunction) {
          const container = document.getElementById("test-container");
          container.innerHTML = html;
          const dateElement = container.querySelector(".test-date");

          if (!dateElement) {
            throw new Error("ãƒ†ã‚¹ãƒˆç”¨æ—¥ä»˜è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
          }

          return extractFunction(dateElement, { includeURL: false });
        },
      };

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", () => {
        window.testController.init();
      });

      // æ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯ç›£è¦–ï¼ˆChromeæ‹¡å¼µæ©Ÿèƒ½ç’°å¢ƒç”¨ï¼‰
      document.addEventListener("click", (event) => {
        if (event.target.classList.contains("chronoclip-date")) {
          const sampleId = event.target.closest('[id^="sample"]')?.id;
          if (sampleId) {
            window.testController.log(
              `${sampleId}ã®æ—¥ä»˜ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§æŠ½å‡ºçµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`
            );
          }
        }
      });
    </script>
  </body>
</html>
