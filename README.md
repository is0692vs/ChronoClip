# ChronoClip

> ウェブ上のあらゆる日付情報を、あなたのカレンダーへシームレスに

## 📋 概要

ChronoClip は、ウェブサイト上の日付情報を自動的に検出し、Google カレンダーに簡単に追加できる Chrome 拡張機能です。イベント情報の手動転記の手間を省き、日常のスケジュール管理をより効率的にします。

## 🔍 主な機能

### 1. 自動検出機能

- ページ内の日付を自動的に検出してハイライト表示
- 検出した日付にカーソルを合わせると視覚的インジケーターを表示
- クリックで即座にカレンダー登録用ポップアップを表示

### 2. イベント情報自動抽出機能

- 日付クリック時に周辺コンテキストからイベント情報を自動抽出
- 見出し、強調テキスト、親要素からタイトルを推定
- 近接する段落や説明文から詳細情報を取得
- 不要なナビゲーションやフッター情報をフィルタリング
- 自動入力されたフォームで手軽にカレンダー追加

### 3. 手動選択機能 ✨ **NEW!**

- テキストを選択して右クリックメニューから「Add to Calendar」でカレンダーに追加
- 日付・時刻・タイトル・詳細を個別に自動抽出
- 抽出に失敗した場合でも手動で編集可能
- 「2025 年 09 月 13 日 (土) 17:30 開場」のような複雑な日付時刻形式にも対応

### 4. サイト固有検出機能 ✨ **NEW!**

- EventBrite、Amazon、楽天などの主要サイトに対応した専用抽出パターン
- サイトごとに最適化されたセレクターと抽出戦略
- 設定ファイルによる簡単なカスタマイズとパターン追加
- 一般的なサイト用のフォールバックパターンも提供

### 5. 統合検出エンジン ✨ **NEW!**

- 選択右クリックと常時ハイライトで共通利用可能な抽出ロジック
- モジュール化されたアーキテクチャで拡張・カスタマイズが容易
- 複数の検出戦略を優先度順で自動適用
- 抽出結果の信頼度スコア計算

### 6. 高度な日付解析

- chrono-node ライブラリによる自然言語日付解析
- 正規表現フォールバックによる幅広い日付形式サポート
- 和暦、英語、相対表現（明日、来週など）に対応
- 時刻情報の自動抽出と終了時刻の推定

## 💡 ユースケース

### イベント予定の管理

コンサートやフェスティバルの公式サイトで「9 月 15 日(土) 17:30 開場 年末特別公演 @武道館」という情報を見つけたら、選択して右クリックするだけで、日付・時刻・タイトルが自動入力されたカレンダー追加フォームが表示されます。

### 予約や締め切り日の記録

「申込期限は 2025 年 10 月 31 日までとなります」という文章を選択して右クリックするだけで、重要な締め切りを見逃さないようにカレンダーに登録できます。

### 学術会議や講演会のスケジュール管理

大学や研究機関のウェブサイトで複数の講演日程を個別に選択し、学術イベントのスケジュールを効率的に管理できます。

### 旅行計画の整理

観光地の営業カレンダーやイベント情報を閲覧しながら、旅行先でのアクティビティをカレンダーに直接登録できます。

## 🎯 特徴

- **汎用性**: 特定のサイトに依存せず、様々なウェブサイトで動作
- **柔軟性**: 自動検出と手動選択のハイブリッド方式で幅広い状況に対応
- **簡便性**: 複雑な設定不要、インストール後すぐに使用可能
- **編集可能性**: 自動抽出に失敗した場合でも手動で修正可能
- **高精度抽出**: chrono-node + 独自ロジックによる高精度な日付時刻抽出

## 📊 想定ユーザー

- イベント参加が多い人（音楽ファン、スポーツ観戦者など）
- 仕事で多くのウェブイベントをチェックする必要がある人
- スケジュール管理を効率化したい人
- 複数のウェブサイトから情報を収集する研究者や学生

## 🚀 期待される効果

1. **時間短縮**: 手動転記の手間を大幅削減（1 イベント 30 秒 → 3 秒）
2. **入力ミス防止**: 日付の転記ミスをなくす
3. **情報の一元管理**: 様々なサイトの情報を統一的にカレンダー管理
4. **見逃し防止**: 興味あるイベントを確実にカレンダー登録

## 🔧 対応する日付形式

````
## 🔧 対応する日付形式

```text
// 対応する日付形式の例
- 2025年8月27日 18:00
- 2025/08/27 18:00
- 2025-08-27T18:00
- 8月27日（水）18時30分
- 8/27（水）6:30pm
- 令和7年8月27日
- Aug 27, 2025 6pm
- 27th August 2025
```

## 🔜 開発ロードマップ

1. ✅ 基本構造のセットアップ - 拡張機能の基本フレームワーク構築
2. ✅ 日付検出機能 - 様々な形式の日付を検出する機能
3. ✅ UI 実装 - 使いやすいインターフェースの構築
4. ✅ Google Calendar 連携 - カレンダーへの追加機能
5. ✅ コンテキスト抽出 - イベント詳細の自動抽出（Issue #10）
6. ✅ 手動選択機能 - 右クリックメニューからの選択範囲追加（Issue #11）
7. ✅ 統合モジュール化 - 拡張性とカスタマイズ性の向上
8. 🔄 高度な機能 - 一括追加、サイト別設定など

## 🛠 技術仕様

### アーキテクチャ

- **Manifest v3**: 最新の Chrome 拡張仕様に準拠
- **Shadow DOM**: UI の分離とスタイル競合回避
- **chrono-node**: 自然言語日付解析ライブラリ
- **OAuth 2.0**: Google Calendar API 認証
- **モジュラー設計**: 検出エンジンと抽出APIの統合アーキテクチャ

### ファイル構成

```text
ChronoClip/
├── manifest.json                 # 拡張機能設定
├── config/
│   ├── constants.js             # 設定定数
│   └── site-patterns.js         # サイト固有検出パターン
├── background/
│   └── service-worker.js        # バックグラウンド処理`

## 🔜 開発ロードマップ

1. ✅ 基本構造のセットアップ - 拡張機能の基本フレームワーク構築
2. ✅ 日付検出機能 - 様々な形式の日付を検出する機能
3. ✅ UI 実装 - 使いやすいインターフェースの構築
4. ✅ Google Calendar 連携 - カレンダーへの追加機能
5. ✅ コンテキスト抽出 - イベント詳細の自動抽出（Issue #10）
6. ✅ 手動選択機能 - 右クリックメニューからの選択範囲追加（Issue #11）
7. 🔄 高度な機能 - 一括追加、サイト別設定など

## � 技術仕様

### アーキテクチャ

- **Manifest v3**: 最新の Chrome 拡張仕様に準拠
- **Shadow DOM**: UI の分離とスタイル競合回避
- **chrono-node**: 自然言語日付解析ライブラリ
- **OAuth 2.0**: Google Calendar API 認証

### ファイル構成

```text
ChronoClip/
├── manifest.json                 # 拡張機能設定
├── background/
│   └── service-worker.js        # バックグラウンド処理
├── content/
│   ├── content-script.js        # メインコンテンツスクリプト
│   ├── event-detector.js        # 統合イベント検出エンジン
│   ├── extractor-api.js         # 統合抽出API
│   ├── extractor.js            # 旧イベント情報抽出ロジック（互換性）
│   └── selection.js            # 手動選択モード処理
├── lib/
│   ├── chrono.min.js           # 日付解析ライブラリ
│   ├── date-parser.js          # 日付解析wrapper
│   ├── date-utils.js           # 日付ユーティリティ
│   └── regex-patterns.js       # 正規表現パターン
├── tests/
│   ├── integrated-module-test.html  # 統合モジュールテスト
│   └── date-parsing-test.html   # 日付解析テスト
├── quick-add-popup.html         # ポップアップUI
├── quick-add-popup.css          # ポップアップスタイル
└── config/
    └── constants.js            # 設定定数
```

## �📄 ライセンス

このプロジェクトは MIT ライセンスの下で公開されています。

## 👥 貢献

バグ報告、機能リクエスト、プルリクエストなど、あらゆる形での貢献を歓迎します。

## セットアップ

## 開発環境のセットアップ

1. Google Cloud Console であなた自身の OAuth 2.0 クライアント ID を作成してください。
   - アプリケーションの種類は「Chrome アプリ」を選択し、アプリケーション ID には拡張機能の ID（開発中は`chrome://extensions`で確認できる ID）を入力してください。
2. このリポジトリにある `manifest.example.json` ファイルをコピーし、`manifest.json` という名前に変更します。
3. 新しく作成した `manifest.json` を開き、以下のプレースホルダーを置き換えてください。
   - `"YOUR_GOOGLE_CLOUD_OAUTH_CLIENT_ID.apps.googleusercontent.com"` の部分を、ステップ 1 で取得したあなた自身のクライアント ID に置き換えます。
   - `"YOUR_GENERATED_EXTENSION_KEY"` の部分を、拡張機能の ID を固定するためのキーに置き換えます。このキーは、一度拡張機能をロードして ID を確認し、その ID からキーを生成するツール（例: [https://www.extensionid.com/](https://www.extensionid.com/)）などを使って生成できます。
4. Chrome 拡張機能の管理画面で、このフォルダを「パッケージ化されていない拡張機能」として読み込みます。

## 設定とカスタマイズ

### 設定ファイル

ChronoClip では、`config/constants.js` ファイルで各種定数と設定を管理しています。これにより、アプリケーションの動作を簡単にカスタマイズできます。

#### 主な設定項目

##### イベント関連設定

- `DEFAULT_DURATION_HOURS`: デフォルトのイベント継続時間（デフォルト: 3 時間）
- `MIN_DURATION_MINUTES`: 最小イベント継続時間（デフォルト: 15 分）
- `MAX_DURATION_HOURS`: 最大イベント継続時間（デフォルト: 24 時間）

##### UI 関連設定

- `POPUP_Z_INDEX`: ポップアップの z-index 値（デフォルト: 99999）
- `POPUP_OFFSET`: ポップアップの表示オフセット（デフォルト: 10px）
- `ANIMATION_DURATION`: アニメーションの持続時間（デフォルト: 200ms）

##### パフォーマンス関連設定

- `MUTATION_DEBOUNCE_MS`: MutationObserver のデバウンス時間（デフォルト: 500ms）

### サイト固有パターンのカスタマイズ ✨ **NEW!**

`config/site-patterns.js`ファイルでサイト固有の検出パターンをカスタマイズできます。

#### カスタムサイトパターンの追加

```javascript
// カスタムパターンの追加例
window.addCustomSitePattern('my-custom-site', {
  domains: ['example.com', 'subdomain.example.com'],
  selectors: {
    title: ['.event-title', 'h1.title'],
    date: ['.event-date', '.schedule'],
    description: ['.event-description', '.content'],
    price: ['.price', '.cost']
  },
  dateFormats: ['YYYY年MM月DD日', 'MM月DD日'],
  priority: 15,  // 優先度（高いほど先に適用）
  extraction: {
    dateStrategy: 'site-specific',
    titleStrategy: 'site-specific',
    descriptionStrategy: 'general'
  }
});
```

#### 既存パターンの更新

```javascript
// 既存パターンの部分更新
window.updateSitePattern('eventbrite', {
  selectors: {
    title: ['.event-title', '.custom-title'],  // セレクターを追加
    // 他の設定は既存のまま保持
  },
  priority: 20  // 優先度のみ変更
});
```

### 抽出戦略のカスタマイズ ✨ **NEW!**

統合検出エンジンに独自の抽出戦略を追加できます。

```javascript
// カスタム抽出戦略の追加例
window.ChronoClipExtractor.addCustomStrategy('my-strategy', {
  extractDate: async (context) => {
    // 独自の日付抽出ロジック
    return dateInfo;
  },
  extractTitle: async (context) => {
    // 独自のタイトル抽出ロジック
    return title;
  },
  extractDescription: async (context) => {
    // 独自の詳細抽出ロジック
    return description;
  },
  priority: 12  // 既存戦略との優先度調整
});
```
- `BATCH_SIZE`: バッチ処理のサイズ（デフォルト: 100）
- `MAX_NODES`: 処理対象の最大ノード数（デフォルト: 1000）

##### 抽出関連設定

- `MAX_TITLE_LENGTH`: タイトル抽出の最大文字数（デフォルト: 100）
- `MAX_DESCRIPTION_LENGTH`: 詳細抽出の最大文字数（デフォルト: 500）
- `NEARBY_SEARCH_RADIUS`: 近傍検索の範囲（デフォルト: 200px）

#### 設定の変更方法

1. `config/constants.js` ファイルを開く
2. `window.ChronoClipConfig` オブジェクト内の該当する値を変更
3. 拡張機能をリロード

例：デフォルトのイベント継続時間を 2 時間に変更する場合：

```javascript
EVENT: {
  DEFAULT_DURATION_HOURS: 2,  // 3から2に変更
  DEFAULT_DURATION_MS: 2 * 60 * 60 * 1000,  // 2時間のミリ秒
  // その他の設定...
}
```
````
